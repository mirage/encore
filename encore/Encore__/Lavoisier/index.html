<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lavoisier (encore.Encore__.Lavoisier)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">encore</a> &#x00BB; <a href="../index.html">Encore__</a> &#x00BB; Lavoisier</nav><h1>Module <code>Encore__.Lavoisier</code></h1></header><dl><dt class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><code><span class="keyword">type</span> state</code><code> = </code><table class="variant"><tr id="type-state.Partial" class="anchored"><td class="def constructor"><a href="#type-state.Partial" class="anchor"></a><code>| </code><code><span class="constructor">Partial</span> <span class="keyword">of</span> <a href="index.html#type-partial">partial</a></code></td></tr><tr id="type-state.Done" class="anchored"><td class="def constructor"><a href="#type-state.Done" class="anchor"></a><code>| </code><code><span class="constructor">Done</span></code></td></tr><tr id="type-state.Fail" class="anchored"><td class="def constructor"><a href="#type-state.Fail" class="anchor"></a><code>| </code><code><span class="constructor">Fail</span></code></td></tr></table></dt><dd><p>Type of lavoisier's state.</p><p>The common way to use it is to fill a <span class="xref-unresolved" title="unresolved reference to &quot;Buffer.t&quot;"><code>Buffer</code>.t</span> when we get the <code>Partial</code> case:</p><pre><code class="ml">let rec go = function
  | Partial { buffer; off; len; continue } -&gt;
      let str = Bigstringaf.substring buffer ~off ~len in
      Buffer.add_string buf str ;
      go (continue ~committed:len)
  | Done -&gt; Buffer.contents buf
  | Fail -&gt; failwith &quot;serialization&quot; in
go (emit v d)</code></pre></dd></dl><dl><dt class="spec type" id="type-partial"><a href="#type-partial" class="anchor"></a><code><span class="keyword">and</span> partial</code><code> = </code><code>{</code><table class="record"><tr id="type-partial.buffer" class="anchored"><td class="def field"><a href="#type-partial.buffer" class="anchor"></a><code>buffer : Bigstringaf.t;</code></td></tr><tr id="type-partial.off" class="anchored"><td class="def field"><a href="#type-partial.off" class="anchor"></a><code>off : int;</code></td></tr><tr id="type-partial.len" class="anchored"><td class="def field"><a href="#type-partial.len" class="anchor"></a><code>len : int;</code></td></tr><tr id="type-partial.continue" class="anchored"><td class="def field"><a href="#type-partial.continue" class="anchor"></a><code>continue : <span>committed:int</span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a>;</code></td></tr></table><code>}</code></dt><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>-'a t</span></code></dt><dd><p>A serializer for values of type <code>'a</code>.</p></dd></dl><dl><dt class="spec value" id="val-emit"><a href="#val-emit" class="anchor"></a><code><span class="keyword">val</span> emit : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-emit_string"><a href="#val-emit_string" class="anchor"></a><code><span class="keyword">val</span> emit_string : <span>?&#8288;chunk:int</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> string</code></dt><dd><p><code>emit_string ?chunk v t</code> runs <code>t</code> with <code>v</code>. The serializer allocates an internal buffer of <code>chunk</code> byte(s) (default to 4096 bytes) and enlarge it if it's needed.</p></dd></dl><dl><dt class="spec value" id="val-char"><a href="#val-char" class="anchor"></a><code><span class="keyword">val</span> char : <span>char <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>char</code> accepts any character and emit it.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : string <span>&#45;&gt;</span> <span>string <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>string str</code> accepts <b>only</b> a string which is equal to <code>str</code> and emits it. Otherwise, it fails.</p></dd></dl><dl><dt class="spec value" id="val-pure"><a href="#val-pure" class="anchor"></a><code><span class="keyword">val</span> pure : <span>compare:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>pure ~compare v</code> accepts <b>only</b> a value <code>'a</code> equal (see <code>compare</code>) to <code>v</code> and emits it. Otherwise, it fails.</p></dd></dl><dl><dt class="spec value" id="val-choose"><a href="#val-choose" class="anchor"></a><code><span class="keyword">val</span> choose : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>choose p q</code> runs <code>p</code> and emits it if succeeds. If <code>p</code> fails, then the output is reset and <code>q</code> will be run instead.</p></dd></dl><dl><dt class="spec value" id="val-put_while0"><a href="#val-put_while0" class="anchor"></a><code><span class="keyword">val</span> put_while0 : <span>(char <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span>string <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>put_while0 p</code> accepts a <code>string</code> which respects the predicate <code>p</code> and emits it.</p></dd></dl><dl><dt class="spec value" id="val-put_while1"><a href="#val-put_while1" class="anchor"></a><code><span class="keyword">val</span> put_while1 : <span>(char <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span>string <a href="index.html#type-t">t</a></span></code></dt><dd><p>Same as <a href="index.html#val-put_while1"><code>put_while1</code></a> but the given <code>string</code> must be not empty.</p></dd></dl><dl><dt class="spec value" id="val-put"><a href="#val-put" class="anchor"></a><code><span class="keyword">val</span> put : <span>(char <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span>string <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>put p n</code> accepts a <code>string</code> which respects the predicate <code>p</code> and must have <code>n</code> bytes. Then, it emits it otherwise it fails. For example, this ABNF:</p><pre>DIGIT := '0' .. '9'
NUMBER := 2DIGIT</pre><p>can be translated to:</p><pre><code class="ml">let number = put (function '0' .. '9' -&gt; true | _ -&gt; false) 2 </code></pre></dd></dl><dl><dt class="spec value" id="val-at_least_put"><a href="#val-at_least_put" class="anchor"></a><code><span class="keyword">val</span> at_least_put : <span>(char <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span>string <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>at_least_put p n</code> accepts a <code>string</code> which respects the predicate <code>p</code> and must have, at least, <code>n</code> bytes. Then, it emits it otherwise it fails. For example, this ABNF:</p><pre>DIGIT := '0' .. '9'
NUMBER := 1*DIGIT</pre><p>can be translated to:</p><pre><code class="ml">let number = at_least_put (function '0' .. '9' -&gt; true | _ -&gt; false) 1</code></pre></dd></dl><dl><dt class="spec value" id="val-range"><a href="#val-range" class="anchor"></a><code><span class="keyword">val</span> range : <span>a:int</span> <span>&#45;&gt;</span> <span>b:int</span> <span>&#45;&gt;</span> <span>(char <span>&#45;&gt;</span> bool)</span> <span>&#45;&gt;</span> <span>string <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-(&lt;*)"><a href="#val-(&lt;*)" class="anchor"></a><code><span class="keyword">val</span> (&lt;*) : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>unit <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-(*&gt;)"><a href="#val-(*&gt;)" class="anchor"></a><code><span class="keyword">val</span> (*&gt;) : <span>unit <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-product"><a href="#val-product" class="anchor"></a><code><span class="keyword">val</span> product : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span class="keyword">val</span> fail : string <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-fix"><a href="#val-fix" class="anchor"></a><code><span class="keyword">val</span> fix : <span>(<span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>(<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-commit"><a href="#val-commit" class="anchor"></a><code><span class="keyword">val</span> commit : <span>unit <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-peek"><a href="#val-peek" class="anchor"></a><code><span class="keyword">val</span> peek : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../../Encore/Either/index.html#type-t">Encore.Either.t</a></span> <a href="index.html#type-t">t</a></span></code></dt></dl></div></body></html>